---
title: Making bsqr
date: "2019-10-26"
syntaxHighlighting: true
draft: true
---

Sometimes I have the thought _"Damn, someone should make this into an
[npx](https://www.npmjs.com/package/npx) script"_ ... well, today I listened to that
voice in my head! In the rest of this post I'll go over what this little utility is & the thought
process that went into creating it.

# First, `bsqr`:

It's a little script that combines [BrowserSync](https://browsersync.io/) with
[`qrcode-terminal`](https://github.com/gtanner/qrcode-terminal) â€” I'm definitely
[standing on the shoulders of
giants](https://en.wikipedia.org/wiki/Standing_on_the_shoulders_of_giants) here,
not reinventing the wheel. Still, I think it's a nifty utility because it solves
one nagging issue I have with BrowserSync: the external URL should be a QR code!
I almost always want to use the external URL on my phone and while [Universal
Clipboard](https://support.apple.com/en-us/HT209460) is nice when I'm working on
my personal machines that won't cut it on my work machine!

So, with that though in mind, I decided to make a utility that would:

1. Get the same external URL BrowserSync is using
2. Display the URL as a QR code
3. Call BrowserSync like normal

Here's a GIF of [`bsqr`](https://github.com/cwervo/bsqr) doing exactly that on
my latop:

![Screen recording of bsqr in action](../../assets/images/making-bsqr/bsqr-documentaton-recording.gif)
<div class="caption">GIF of <code>bsqr</code> on desktop</div>

& then on my phone:

<img src="../../assets/images/making-bsqr/bsqr-iphone.gif" alt="Screen recording of bsqr being scanned" style="max-width: 50%">
<div class="caption">GIF of <code>bsqr</code> being scanned on an iPhone</div>

So what did it take to create?

# How I got the idea

I've known about BrowserSync for a long time but I didn't really appreciate
how great it is until I started using [11ty](https://www.11ty.io/) a lot!
Whenever I'm working [on this very
website](http://github.com/cwervo/cwervo.com) I would see this:

![GIF recording of the terminal output showing BrowserSync URLs](../../assets/images/making-bsqr/cwervo-bs-recording.gif)
<div class="caption">See the BrowserSync output at the end? That's what inspired me!</div>

So my first thought was to go to the [BrowserSync API
docs](https://browsersync.io/docs/api) â€” sure enough, it's designed to be
scripted as well as run from the command line ðŸŽ‰!

## Writing the actual script

### Writing step 1.

Here all I really did was paste & modify a version of [the docs API sample](https://browsersync.io/docs/api):

```javascript
#!/usr/bin/env node
// require the module as normal
let bs = require("browser-sync").create();

// .init starts the server
bs.init({
    server: "." // NOTE: I use the current working directory instead of './app'
});

// Now call methods on bs instead of the
// main browserSync module export
bs.reload("*"); // NOTE: Here I chose to reload everything
```

This got the basic BrowserSync features running, so yay!

### Next, step 2.

The next easiest piece was pulling the other off-the-shelf dependency,
[`qrcode-terminal`](https://github.com/gtanner/qrcode-terminal), off the
proverbial shelf like so:

```
#!/usr/bin/env node
// require the module as normal
let bs = require("browser-sync").create();
let qrcode = require('qrcode-terminal');

// .init starts the server
bs.init({
    server: "."
});

/*
 * NOTE: Here we're just adding a text QR code to prove it's possible
 */
qrcode.generate('lorem ipsum', {small: true});


// Now call methods on bs instead of the
// main browserSync module export
bs.reload("*"); // NOTE: Here I chose to reload everything`
```

This little script sure enough starts a `bs` server right after outputting the
QR code for `lorem ipsum`:

![A screenshot of the lorem ipsum QR code in the terminal](../../assets/images/making-bsqr/lorem-ipsum-qr.png)
<div class="caption">This QR code is generated by the script above & encodes the
words 'lorem ipsum'</div>

### Last, but not least, step 3.

Finally, I knew I needed to fill in the QR code text with the actual external
URL. I saved it for last because I was pretty sure this would take the most
work ðŸ˜¬.

There's [a note on the docs page](https://www.browsersync.io/docs#external-url)
about using "a tool _like_ [`dev-ip`](https://github.com/shakyshane/dev-ip)" (italics mine) to
find the correct IP address, which I thought was interesting but I ignored when
I read it. The 


Finally, it turned out to be [this
line](https://github.com/BrowserSync/browser-sync/blob/master/packages/browser-sync/lib/utils.ts#L29)
that shows you

<!-- Here is a footnote reference,[^1] and another.[^longnote] -->
<!--  -->
<!-- [^1]: Here is the footnote. -->
